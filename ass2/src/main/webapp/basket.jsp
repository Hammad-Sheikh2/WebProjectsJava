<%@ page import="java.util.Collection,                 java.util.Iterator"%><%@ page import="shop.Product" %><%@ page import="java.util.ArrayList" %><jsp:useBean id='basket'         scope='session'         class='shop.Basket'          /><%    String empty = request.getParameter("emptyBasket");    if (empty!=null) {        basket.clearBasket();        response.sendRedirect("./basket.jsp");    }    String item = request.getParameter("addItem");    if(item!=null){        basket.addItem(item);        response.sendRedirect("./basket.jsp");    }    String PID=request.getParameter("removeItem");    if(PID!=null){        basket.removeItem(PID);        response.sendRedirect("./basket.jsp");    }    String increaseQuantityPID=request.getParameter("increaseQuantity");    if(increaseQuantityPID!=null){        basket.increaseQuantity(increaseQuantityPID);        response.sendRedirect("./basket.jsp");    }    String decreaseQuantityPID=request.getParameter("decreaseQuantity");    if(decreaseQuantityPID!=null){        basket.decreaseQuantity(decreaseQuantityPID);        response.sendRedirect("./basket.jsp");    }    ArrayList<Product> items = basket.getItems();    ArrayList<Integer> quantities=basket.getItemsQuantities();    /*HashMap<String,Collection<Product>> itemsGroupByPID = new HashMap<String,Collection<Product>>();    for (Product product:items) {        String key = product.PID;        if (itemsGroupByPID.get(key) == null) {            itemsGroupByPID.put(key, new ArrayList<Product>());        }        itemsGroupByPID.get(key).add(product);    }*/%><html><head>    <link rel="stylesheet" href="style.css"></head><body><table class="table">    <thead>        <tr>            <th>Title</th>            <th>Picture</th>            <th>Quantity</th>            <th>Price</th>            <th></th>            <th></th>            <th></th>        </tr>    </thead>    <tbody><%    for (int i = 0; i < items.size(); i++) {         Product p = items.get(i);       %>        <tr>            <td><%=p.title%></td>            <td><img src="<%=p.thumbnail%>"></td>            <td><%=quantities.get(i)%></td>            <td><%=Math.round((p.price*quantities.get(i))*100)/100 %></td>            <td><a href='<%="basket.jsp?increaseQuantity="+p.PID%>'>Increase Quantity</a></td>            <td><a href='<%="basket.jsp?decreaseQuantity="+p.PID%>'>Decrease Quantity</a></td>            <td><a href='<%="basket.jsp?removeItem="+p.PID%>'>Remove</a></td>        </tr><%   }    %>    </tbody></table><p> Order total = <%= basket.getTotalString() %><%    if ( basket.getTotal() > 0) {        %>        <form action="order.jsp" method="post">        <input type="text" name="name" size="20" required>        <input class="btn" type="submit" value="Place Order" />        </form>        <form action="basket.jsp" method="get">        <input type="hidden" name="emptyBasket" value="yes">        <input class="btn" type="submit" value="Empty Basket" />        </form>        <%    }%></body></html>